-- ã‚¹ãƒãƒ›ç”¨ã‚·ãƒ³ãƒ—ãƒ«Flyã‚¹ã‚¯ãƒªãƒ—ãƒˆï¼ˆLocalScriptï¼‰
-- StarterPlayerScripts ã¾ãŸã¯ StarterGui ã«é…ç½®ã—ã¦ãã ã•ã„

local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")

local player = Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")

local flying = false
local flySpeed = 50

local bodyVelocity
local bodyAngularVelocity

-- ã‚¿ãƒƒãƒæ“ä½œç”¨ã®å¤‰æ•°
local isMovingUp = false
local isMovingDown = false

-- GUIä½œæˆ
local function createMobileFlyGui()
    local screenGui = Instance.new("ScreenGui")
    screenGui.Name = "MobileFlyGui"
    screenGui.Parent = playerGui
    
    -- ãƒ¡ã‚¤ãƒ³ãƒ•ãƒ¬ãƒ¼ãƒ 
    local mainFrame = Instance.new("Frame")
    mainFrame.Name = "MainFrame"
    mainFrame.Size = UDim2.new(0, 300, 0, 120)
    mainFrame.Position = UDim2.new(0, 10, 0, 10)
    mainFrame.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
    mainFrame.BorderSizePixel = 0
    mainFrame.Parent = screenGui
    
    -- ã‚³ãƒ¼ãƒŠãƒ¼ã‚’ä¸¸ãã™ã‚‹
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 12)
    corner.Parent = mainFrame
    
    -- ã‚¿ã‚¤ãƒˆãƒ«
    local title = Instance.new("TextLabel")
    title.Size = UDim2.new(1, 0, 0, 30)
    title.Position = UDim2.new(0, 0, 0, 0)
    title.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
    title.BorderSizePixel = 0
    title.Text = "ğŸ“± ãƒ¢ãƒã‚¤ãƒ« Fly"
    title.TextColor3 = Color3.fromRGB(0, 150, 255)
    title.TextSize = 16
    title.Font = Enum.Font.SourceSansBold
    title.Parent = mainFrame
    
    local titleCorner = Instance.new("UICorner")
    titleCorner.CornerRadius = UDim.new(0, 10)
    titleCorner.Parent = title
    
    -- Flyãƒœã‚¿ãƒ³
    local flyButton = Instance.new("TextButton")
    flyButton.Size = UDim2.new(0, 100, 0, 40)
    flyButton.Position = UDim2.new(0, 15, 0, 40)
    flyButton.BackgroundColor3 = Color3.fromRGB(0, 150, 0)
    flyButton.BorderSizePixel = 0
    flyButton.Text = "âœˆï¸ Flyé–‹å§‹"
    flyButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    flyButton.TextSize = 14
    flyButton.Font = Enum.Font.SourceSansBold
    flyButton.Parent = mainFrame
    
    local buttonCorner = Instance.new("UICorner")
    buttonCorner.CornerRadius = UDim.new(0, 8)
    buttonCorner.Parent = flyButton
    
    -- é€Ÿåº¦ãƒ©ãƒ™ãƒ«
    local speedLabel = Instance.new("TextLabel")
    speedLabel.Size = UDim2.new(0, 80, 0, 20)
    speedLabel.Position = UDim2.new(0, 130, 0, 40)
    speedLabel.BackgroundTransparency = 1
    speedLabel.Text = "âš¡ é€Ÿåº¦: " .. flySpeed
    speedLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    speedLabel.TextSize = 12
    speedLabel.Font = Enum.Font.SourceSans
    speedLabel.Parent = mainFrame
    
    -- é€Ÿåº¦ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã®ãƒ•ãƒ¬ãƒ¼ãƒ 
    local sliderFrame = Instance.new("Frame")
    sliderFrame.Size = UDim2.new(0, 140, 0, 10)
    sliderFrame.Position = UDim2.new(0, 130, 0, 65)
    sliderFrame.BackgroundColor3 = Color3.fromRGB(70, 70, 70)
    sliderFrame.BorderSizePixel = 0
    sliderFrame.Parent = mainFrame
    
    local sliderFrameCorner = Instance.new("UICorner")
    sliderFrameCorner.CornerRadius = UDim.new(0, 5)
    sliderFrameCorner.Parent = sliderFrame
    
    -- é€Ÿåº¦ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã®ãƒãƒ³ãƒ‰ãƒ«
    local sliderHandle = Instance.new("Frame")
    sliderHandle.Size = UDim2.new(0, 20, 0, 20)
    sliderHandle.Position = UDim2.new(0, 45, 0, -5) -- åˆæœŸä½ç½®ï¼ˆé€Ÿåº¦50ã«å¯¾å¿œï¼‰
    sliderHandle.BackgroundColor3 = Color3.fromRGB(0, 150, 255)
    sliderHandle.BorderSizePixel = 0
    sliderHandle.Parent = sliderFrame
    
    local handleCorner = Instance.new("UICorner")
    handleCorner.CornerRadius = UDim.new(0, 10)
    handleCorner.Parent = sliderHandle
    
    -- çŠ¶æ…‹è¡¨ç¤º
    local statusLabel = Instance.new("TextLabel")
    statusLabel.Size = UDim2.new(1, 0, 0, 18)
    statusLabel.Position = UDim2.new(0, 0, 0, 95)
    statusLabel.BackgroundTransparency = 1
    statusLabel.Text = "ğŸ“ çŠ¶æ…‹: å¾…æ©Ÿä¸­ | ã‚¸ãƒ§ã‚¤ã‚¹ãƒ†ã‚£ãƒƒã‚¯ã§ç§»å‹•"
    statusLabel.TextColor3 = Color3.fromRGB(180, 180, 180)
    statusLabel.TextSize = 11
    statusLabel.Font = Enum.Font.SourceSans
    statusLabel.Parent = mainFrame
    
    -- ä¸Šæ˜‡ãƒ»ä¸‹é™ãƒœã‚¿ãƒ³ãƒ•ãƒ¬ãƒ¼ãƒ ï¼ˆå³å´ï¼‰
    local controlFrame = Instance.new("Frame")
    controlFrame.Name = "ControlFrame"
    controlFrame.Size = UDim2.new(0, 70, 0, 100)
    controlFrame.Position = UDim2.new(1, -80, 1, -110)
    controlFrame.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
    controlFrame.BorderSizePixel = 0
    controlFrame.Parent = screenGui
    
    local controlCorner = Instance.new("UICorner")
    controlCorner.CornerRadius = UDim.new(0, 12)
    controlCorner.Parent = controlFrame
    
    -- ä¸Šæ˜‡ãƒœã‚¿ãƒ³
    local upButton = Instance.new("TextButton")
    upButton.Size = UDim2.new(0, 60, 0, 40)
    upButton.Position = UDim2.new(0, 5, 0, 5)
    upButton.BackgroundColor3 = Color3.fromRGB(0, 180, 0)
    upButton.BorderSizePixel = 0
    upButton.Text = "â¬†ï¸"
    upButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    upButton.TextSize = 18
    upButton.Font = Enum.Font.SourceSansBold
    upButton.Parent = controlFrame
    
    local upCorner = Instance.new("UICorner")
    upCorner.CornerRadius = UDim.new(0, 8)
    upCorner.Parent = upButton
    
    -- ä¸‹é™ãƒœã‚¿ãƒ³
    local downButton = Instance.new("TextButton")
    downButton.Size = UDim2.new(0, 60, 0, 40)
    downButton.Position = UDim2.new(0, 5, 0, 55)
    downButton.BackgroundColor3 = Color3.fromRGB(200, 0, 0)
    downButton.BorderSizePixel = 0
    downButton.Text = "â¬‡ï¸"
    downButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    downButton.TextSize = 18
    downButton.Font = Enum.Font.SourceSansBold
    downButton.Parent = controlFrame
    
    local downCorner = Instance.new("UICorner")
    downCorner.CornerRadius = UDim.new(0, 8)
    downCorner.Parent = downButton
    
    return flyButton, speedLabel, sliderFrame, sliderHandle, statusLabel, upButton, downButton
end

-- ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼æ“ä½œã®è¨­å®š
local function setupSpeedSlider(sliderFrame, sliderHandle, speedLabel)
    local isDragging = false
    local connection
    
    -- ãƒãƒ³ãƒ‰ãƒ«ã®ã‚¿ãƒƒãƒæ“ä½œ
    sliderHandle.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.Touch then
            isDragging = true
            
            connection = UserInputService.InputChanged:Connect(function(input)
                if isDragging and input.UserInputType == Enum.UserInputType.Touch then
                    local framePosition = sliderFrame.AbsolutePosition.X
                    local frameSize = sliderFrame.AbsoluteSize.X
                    local inputX = input.Position.X
                    
                    -- ãƒãƒ³ãƒ‰ãƒ«ã®ä½ç½®ã‚’è¨ˆç®—ï¼ˆ0ã‹ã‚‰1ã®ç¯„å›²ï¼‰
                    local relativeX = math.max(0, math.min(1, (inputX - framePosition) / frameSize))
                    
                    -- ãƒãƒ³ãƒ‰ãƒ«ã®ä½ç½®ã‚’æ›´æ–°
                    sliderHandle.Position = UDim2.new(relativeX, -10, 0, -5)
                    
                    -- é€Ÿåº¦ã‚’è¨ˆç®—ï¼ˆ5ã‹ã‚‰200ã®ç¯„å›²ï¼‰
                    flySpeed = math.floor(5 + relativeX * 195)
                    speedLabel.Text = "âš¡ é€Ÿåº¦: " .. flySpeed
                end
            end)
        end
    end)
    
    sliderHandle.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.Touch then
            isDragging = false
            if connection then
                connection:Disconnect()
            end
        end
    end)
    
    -- ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ãƒ•ãƒ¬ãƒ¼ãƒ ã‚’ã‚¿ãƒƒãƒ—ã—ãŸæ™‚ã®å‡¦ç†
    sliderFrame.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.Touch and not isDragging then
            local framePosition = sliderFrame.AbsolutePosition.X
            local frameSize = sliderFrame.AbsoluteSize.X
            local inputX = input.Position.X
            
            local relativeX = math.max(0, math.min(1, (inputX - framePosition) / frameSize))
            
            sliderHandle.Position = UDim2.new(relativeX, -10, 0, -5)
            flySpeed = math.floor(5 + relativeX * 195)
            speedLabel.Text = "âš¡ é€Ÿåº¦: " .. flySpeed
        end
    end)
end

-- Flyé–‹å§‹é–¢æ•°
local function startFly(character)
    local humanoidRootPart = character:FindFirstChild("HumanoidRootPart")
    if not humanoidRootPart then return end
    
    bodyVelocity = Instance.new("BodyVelocity")
    bodyVelocity.MaxForce = Vector3.new(400000, 400000, 400000)
    bodyVelocity.Velocity = Vector3.new(0, 0, 0)
    bodyVelocity.Parent = humanoidRootPart
    
    bodyAngularVelocity = Instance.new("BodyAngularVelocity")
    bodyAngularVelocity.MaxTorque = Vector3.new(400000, 400000, 400000)
    bodyAngularVelocity.AngularVelocity = Vector3.new(0, 0, 0)
    bodyAngularVelocity.Parent = humanoidRootPart
    
    flying = true
    print("ğŸ“± ãƒ¢ãƒã‚¤ãƒ«Flyé–‹å§‹ï¼")
end

-- Flyåœæ­¢é–¢æ•°
local function stopFly()
    if bodyVelocity then
        bodyVelocity:Destroy()
        bodyVelocity = nil
    end
    if bodyAngularVelocity then
        bodyAngularVelocity:Destroy()
        bodyAngularVelocity = nil
    end
    
    flying = false
    isMovingUp = false
    isMovingDown = false
    print("ğŸ“± ãƒ¢ãƒã‚¤ãƒ«Flyåœæ­¢ï¼")
end

-- GUIä½œæˆã¨ã‚¤ãƒ™ãƒ³ãƒˆæ¥ç¶š
local flyButton, speedLabel, sliderFrame, sliderHandle, statusLabel, upButton, downButton = createMobileFlyGui()

-- ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼è¨­å®š
setupSpeedSlider(sliderFrame, sliderHandle, speedLabel)

-- Flyãƒœã‚¿ãƒ³ã®ã‚¿ãƒƒãƒã‚¤ãƒ™ãƒ³ãƒˆ
flyButton.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.Touch then
        local character = player.Character
        if character and character:FindFirstChild("HumanoidRootPart") then
            if flying then
                stopFly()
                flyButton.Text = "âœˆï¸ Flyé–‹å§‹"
                flyButton.BackgroundColor3 = Color3.fromRGB(0, 150, 0)
                statusLabel.Text = "ğŸ“ çŠ¶æ…‹: å¾…æ©Ÿä¸­ | ã‚¸ãƒ§ã‚¤ã‚¹ãƒ†ã‚£ãƒƒã‚¯ã§ç§»å‹•"
                statusLabel.TextColor3 = Color3.fromRGB(180, 180, 180)
            else
                startFly(character)
                flyButton.Text = "ğŸ›‘ Flyåœæ­¢"
                flyButton.BackgroundColor3 = Color3.fromRGB(200, 0, 0)
                statusLabel.Text = "ğŸ“ çŠ¶æ…‹: Flyä¸­ | ã‚¸ãƒ§ã‚¤ã‚¹ãƒ†ã‚£ãƒƒã‚¯ã§ç§»å‹•"
                statusLabel.TextColor3 = Color3.fromRGB(0, 255, 100)
            end
        end
    end
end)

-- ä¸Šæ˜‡ãƒœã‚¿ãƒ³
upButton.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.Touch then
        isMovingUp = true
        upButton.BackgroundColor3 = Color3.fromRGB(0, 220, 0)
    end
end)

upButton.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.Touch then
        isMovingUp = false
        upButton.BackgroundColor3 = Color3.fromRGB(0, 180, 0)
    end
end)

-- ä¸‹é™ãƒœã‚¿ãƒ³
downButton.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.Touch then
        isMovingDown = true
        downButton.BackgroundColor3 = Color3.fromRGB(240, 0, 0)
    end
end)

downButton.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.Touch then
        isMovingDown = false
        downButton.BackgroundColor3 = Color3.fromRGB(200, 0, 0)
    end
end)

-- Flyä¸­ã®ç§»å‹•å‡¦ç†
RunService.Heartbeat:Connect(function()
    if not flying or not bodyVelocity or not player.Character then
        return
    end
    
    local character = player.Character
    local humanoidRootPart = character:FindFirstChild("HumanoidRootPart")
    local humanoid = character:FindFirstChild("Humanoid")
    
    if not humanoidRootPart or not humanoid then
        return
    end
    
    local camera = workspace.CurrentCamera
    local moveVector = humanoid.MoveDirection
    
    -- ã‚«ãƒ¡ãƒ©ã®å‘ãã‚’åŸºæº–ã¨ã—ãŸç§»å‹•ãƒ™ã‚¯ãƒˆãƒ«
    local cameraCFrame = camera.CFrame
    local forwardVector = cameraCFrame.LookVector
    local rightVector = cameraCFrame.RightVector
    
    -- ç§»å‹•æ–¹å‘ã‚’è¨ˆç®—ï¼ˆæ—¢å­˜ã®ã‚¸ãƒ§ã‚¤ã‚¹ãƒ†ã‚£ãƒƒã‚¯ä½¿ç”¨ï¼‰
    local flyDirection = (forwardVector * moveVector.Z + rightVector * moveVector.X)
    
    -- ä¸Šä¸‹ç§»å‹•ã®å‡¦ç†ï¼ˆã‚¿ãƒƒãƒãƒœã‚¿ãƒ³ï¼‰
    local upDown = 0
    if isMovingUp then
        upDown = 1
    elseif isMovingDown then
        upDown = -1
    end
    
    -- æœ€çµ‚çš„ãªç§»å‹•ãƒ™ã‚¯ãƒˆãƒ«
    local finalVelocity = flyDirection * flySpeed + Vector3.new(0, upDown * flySpeed, 0)
    bodyVelocity.Velocity = finalVelocity
    
    -- å›è»¢ã‚’å›ºå®š
    bodyAngularVelocity.AngularVelocity = Vector3.new(0, 0, 0)
end)

-- ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒãƒªã‚¹ãƒãƒ¼ãƒ³ã—ãŸã¨ãã®å‡¦ç†
player.CharacterAdded:Connect(function(character)
    if flying then
        flying = false
        bodyVelocity = nil
        bodyAngularVelocity = nil
        flyButton.Text = "âœˆï¸ Flyé–‹å§‹"
        flyButton.BackgroundColor3 = Color3.fromRGB(0, 150, 0)
        statusLabel.Text = "ğŸ“ çŠ¶æ…‹: å¾…æ©Ÿä¸­ | ã‚¸ãƒ§ã‚¤ã‚¹ãƒ†ã‚£ãƒƒã‚¯ã§ç§»å‹•"
        statusLabel.TextColor3 = Color3.fromRGB(180, 180, 180)
        isMovingUp = false
        isMovingDown = false
    end
end)

print("ğŸ“± ã‚¹ãƒãƒ›ç”¨Flyã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒèª­ã¿è¾¼ã¾ã‚Œã¾ã—ãŸï¼")
print("æ“ä½œæ–¹æ³•:")
print("1. Flyãƒœã‚¿ãƒ³ã‚’ã‚¿ãƒƒãƒã§é£›è¡Œé–‹å§‹/åœæ­¢")
print("2. ã‚¸ãƒ§ã‚¤ã‚¹ãƒ†ã‚£ãƒƒã‚¯ã§ç§»å‹•æ–¹å‘ã‚’åˆ¶å¾¡")
print("3. â¬†ï¸â¬‡ï¸ãƒœã‚¿ãƒ³ã‚’ã‚¿ãƒƒãƒã§ä¸Šæ˜‡ãƒ»ä¸‹é™")
print("4. ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã‚’ã‚¿ãƒƒãƒã§é€Ÿåº¦èª¿æ•´")
print("3. ã‚¹ãƒšãƒ¼ã‚¹ã‚­ãƒ¼ã§ä¸Šæ˜‡ã€å·¦ã‚·ãƒ•ãƒˆã§ä¸‹é™")
print("4. ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã§é€Ÿåº¦èª¿æ•´ï¼ˆ5-200ï¼‰")
